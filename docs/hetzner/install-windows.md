# Файловая система Linux

Чаще всего использую **Debian 11**

## ⌨️ Format file system

### Форматирование файловых систем:

```bash
mke2fs /dev/hda1 — создать файловую систему ext2 на разделе hda1
mke2fs -j /dev/hda1 — создать журналирующую файловую систему ext3 на разделе hda1
mkfs -t vfat 32 -F /dev/hda1 — создать файловую систему FAT32 на разделе hda1
fdformat -n /dev/fd0 — форматирование флоппи-диска без проверки
mkswap /dev/hda3 — создание swap-пространства на разделе hda3
```

###  Swap storage

**swap**-пространство:

```bash
swapon /dev/hda3 — активировать swap-пространство, расположенное на разделе hda3 
swapon /dev/hda2 /dev/hdb3 — активировать swap-пространства, расположенные на разделах hda2 и hdb3
```
###  Clear files, systems, temp

Очистка системы \ временные файлы \ кеш обновлений \

!!! Будь осторожен можно сломать дистрибутив

```bash
sudo apt-get autoclean -y - удалить скачанные файлы архивов 
sudo apt-get clean -y - удалить старые скачанные файлы архивов 
sudo apt-get install -f -y - решение проблем с установкой по
```

## Raid cheat sheet

### Шпаргалка по **RAID**

`mdadm` — утилита для работы с программными **RAID-массивами** различных уровней. В данной инструкции рассмотрим примеры ее использования.

### Информация о **RAID**
```bash
cat /proc/mdstat - состояние всех RAID 
mdadm -D /dev/md0 - подробная инфа о конкретном RAID 
lsblk - список дисков с разделами, местом, типом 
df -hT - свободное место, тип файловой системы, точки монтирования
```
### Сборка **RAID**

```bash
- mdadm —zero-superblock —force /dev/sd{b,c} - обнуление суперблоков на дисках sdb sdc
(для удаления инфы о других RAID) при получении ответа

- mdadm: Unrecognised md component device - /dev/sdb значит, что диск не использовался для RAID, 
 
продолжаем

mdadm —create —verbose /dev/md0 -l 1 -n 2 /dev/sd{b,c}

- где /dev/md0 — устройство RAID, которое появится после сборки; 
- -l 1 — уровень RAID; 
- -n 2 — количество дисков, из которых собирается массив; 
- /dev/sd{b,c} — сборка выполняется из дисков sdb и sdc.
```

### Создание файловой системы и монтирование массива

```bash
- mkfs.ext4 /dev/md0 - создание файловой системы ext4 на md0
- mount /dev/md0 /mnt - разово примонтировать md0 к /mnt
- nano /etc/fstab, прописать /dev/md0 /mnt ext4 defaults 1 2 
постоянное монтирование, работает после перезагрузки
```

### Восстановление **RAID**

Замена жесткого диска. При выходе из строя, команда `mdadm -D /dev/md0` выдаст: **State : clean, degraded**

```bash
- mdadm /dev/md0 —remove /dev/sdc - удалить сбойный диск
- mdadm /dev/md0 —add /dev/sde - добавить новый диск в массив
```

Статус должен стать **Rebuild Status : 40% complete** и так до полного восстановления

Пересборка массива. Если нам нужно вернуть ранее разобранный или развалившийся массив из дисков, которые уже входили в состав **RAID**, вводим:

```bash
mdadm —assemble —scan - команда сама найдет необходимую конфигурацию и восстановит RAID.
mdadm —assemble /dev/md0 /dev/sdb /dev/sdc - с указанием из каких дисков пересобрать
```

#### Запасной диск **(Hot Spare)**

Если в массиве будет запасной диск для горячей замены, при выходе из строя одного из основных дисков, его место займет запасной.

```bash
- mdadm /dev/md0 —add /dev/sdd - Диском Hot Spare станет тот, который просто будет добавлен к массиву
```
Добавить диск к массиву, расширить массив

Добавление активного диска к **RAID**, который будет использоваться для работы, а не в качестве запасного.

```bash
-mdadm /dev/md0 —add /dev/sde    
-mdadm -G /dev/md0 —raid-devices=3 - расширяем RAID
```    
в данном примере подразумевается, что у нас **RAID 1** и мы добавили к нему **3-й** диск.

## Установка mdadm

Если каким-то образом в дистрибутиве нет этого пакета `apt-get install mdadm`

Удаление массива

Если нам нужно полностью разобрать **RAID**, сначала размонтируем и остановим его: 


```bash
- umount /mnt - Остановка RAID
- где /mnt — каталог монтирования нашего RAID.
- mdadm -S /dev/md0
```

Затем очищаем суперблоки на всех дисках, из которых он был собран:

```bash
- mdadm —zero-superblock /dev/sdb
- mdadm —zero-superblock /dev/sdc
- mdadm —zero-superblock /dev/sdd
```